{% extends 'layout/dashboard_base.html.twig' %}

{% block title %}{{ annonce.titre }} - Annonces - RH NewLife{% endblock %}

{% block breadcrumb_items %}
    <li>
        <div class="flex items-center">
            <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
            </svg>
            <a href="{{ path('admin_annonce_interne_index') }}" class="ml-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ml-2 dark:text-gray-400 dark:hover:text-white">
                Annonces
            </a>
        </div>
    </li>
    <li>
        <div class="flex items-center">
            <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
            </svg>
            <span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400">Consulter</span>
        </div>
    </li>
{% endblock %}

{% block page_header %}
    <div class="px-4 py-6 lg:px-6">
        <div class="flex items-start justify-between gap-4">
            <div class="flex items-start gap-4">
                <a href="{{ path('admin_annonce_interne_index') }}"
                   class="p-2 rounded-lg bg-white/20 hover:bg-white/30 transition-colors flex-shrink-0 mt-1">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </a>
                <div class="min-w-0">
                    <div class="flex items-center gap-2 flex-wrap">
                        <h1 class="text-2xl md:text-3xl font-bold text-white">
                            {{ annonce.titre }}
                        </h1>
                        {% if annonce.epingle %}
                            <span class="glass-badge glass-badge-warning inline-flex items-center gap-1 bg-amber-500/30 text-amber-100">
                                <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M5 5a2 2 0 012-2h6a2 2 0 012 2v2H5V5zm0 4h10v6a2 2 0 01-2 2H7a2 2 0 01-2-2V9z"/>
                                </svg>
                                Epinglee
                            </span>
                        {% endif %}
                    </div>
                    <p class="text-blue-100 text-sm md:text-base mt-1">
                        Publiee par {{ annonce.publiePar.fullName }} le {{ annonce.datePublication|date('d/m/Y a H:i') }}
                    </p>
                </div>
            </div>
            <a href="{{ path('admin_annonce_interne_edit', {id: annonce.id}) }}"
               class="glass-btn glass-btn-primary inline-flex items-center gap-2 flex-shrink-0">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
                Modifier
            </a>
        </div>
    </div>
{% endblock %}

{% block dashboard_content %}
<div class="max-w-4xl mx-auto space-y-6">
    {# Status card #}
    <div class="glass-card p-4 flex flex-wrap items-center gap-4">
        <div class="flex items-center gap-2">
            <span class="text-sm text-gray-500 dark:text-gray-400">Statut:</span>
            {% if annonce.actif %}
                {% if annonce.isExpired %}
                    <span class="glass-badge glass-badge-warning">Expiree</span>
                {% else %}
                    <span class="glass-badge glass-badge-success">Active</span>
                {% endif %}
            {% else %}
                <span class="glass-badge glass-badge-danger">Inactive</span>
            {% endif %}
        </div>
        <div class="flex items-center gap-2">
            <span class="text-sm text-gray-500 dark:text-gray-400">Visibilite:</span>
            <span class="glass-badge glass-badge-{% if annonce.visibilite == 'tous' %}success{% elseif annonce.visibilite == 'admin' %}danger{% else %}primary{% endif %}">
                {{ annonce.visibiliteLabel }}
            </span>
        </div>
        {% if annonce.dateExpiration %}
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-500 dark:text-gray-400">Expiration:</span>
                {% set daysLeft = annonce.daysUntilExpiration %}
                <span class="text-sm {% if daysLeft is not null and daysLeft < 7 %}text-orange-500 font-medium{% else %}text-gray-900 dark:text-white{% endif %}">
                    {{ annonce.dateExpiration|date('d/m/Y') }}
                    {% if daysLeft is not null %}
                        {% if daysLeft < 0 %}
                            (expiree)
                        {% elseif daysLeft == 0 %}
                            (aujourd'hui)
                        {% elseif daysLeft == 1 %}
                            (demain)
                        {% else %}
                            ({{ daysLeft }} jours)
                        {% endif %}
                    {% endif %}
                </span>
            </div>
        {% endif %}
    </div>

    {# Main content #}
    <div class="glass-card overflow-hidden">
        {% if annonce.image %}
            <div class="relative h-64 md:h-80">
                <img src="{{ asset('uploads/' ~ annonce.image) }}"
                     alt="{{ annonce.titre }}"
                     class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
            </div>
        {% endif %}

        <div class="p-6">
            <div class="prose prose-emerald dark:prose-invert max-w-none">
                {{ annonce.contenu|nl2br }}
            </div>
        </div>
    </div>

    {# Meta info #}
    <div class="glass-card p-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
            <div>
                <span class="block text-gray-500 dark:text-gray-400 mb-1">Publiee par</span>
                <span class="text-gray-900 dark:text-white font-medium">{{ annonce.publiePar.fullName }}</span>
            </div>
            <div>
                <span class="block text-gray-500 dark:text-gray-400 mb-1">Date publication</span>
                <span class="text-gray-900 dark:text-white font-medium">{{ annonce.datePublication|date('d/m/Y H:i') }}</span>
            </div>
            <div>
                <span class="block text-gray-500 dark:text-gray-400 mb-1">Creee le</span>
                <span class="text-gray-900 dark:text-white font-medium">{{ annonce.createdAt|date('d/m/Y H:i') }}</span>
            </div>
            <div>
                <span class="block text-gray-500 dark:text-gray-400 mb-1">Modifiee le</span>
                <span class="text-gray-900 dark:text-white font-medium">{{ annonce.updatedAt|date('d/m/Y H:i') }}</span>
            </div>
        </div>
    </div>

    {# Actions #}
    <div class="flex items-center justify-between">
        <a href="{{ path('admin_annonce_interne_index') }}" class="glass-btn px-4 py-2 inline-flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            Retour a la liste
        </a>

        <div class="flex items-center gap-2">
            {# Toggle pin #}
            <form action="{{ path('admin_annonce_interne_toggle_pin', {id: annonce.id}) }}" method="POST" class="inline">
                <input type="hidden" name="_token" value="{{ csrf_token('toggle_pin' ~ annonce.id) }}">
                <button type="submit"
                        class="glass-btn px-4 py-2 inline-flex items-center gap-2 {% if annonce.epingle %}text-amber-500{% endif %}">
                    <svg class="w-4 h-4" fill="{% if annonce.epingle %}currentColor{% else %}none{% endif %}" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
                    </svg>
                    {{ annonce.epingle ? 'Desepingler' : 'Epingler' }}
                </button>
            </form>

            {# Toggle active #}
            {% if annonce.actif %}
                <form action="{{ path('admin_annonce_interne_deactivate', {id: annonce.id}) }}" method="POST" class="inline">
                    <input type="hidden" name="_token" value="{{ csrf_token('deactivate' ~ annonce.id) }}">
                    <button type="submit"
                            class="glass-btn px-4 py-2 inline-flex items-center gap-2"
                            onclick="return confirm('Desactiver cette annonce ?')">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/>
                        </svg>
                        Desactiver
                    </button>
                </form>
            {% else %}
                <form action="{{ path('admin_annonce_interne_activate', {id: annonce.id}) }}" method="POST" class="inline">
                    <input type="hidden" name="_token" value="{{ csrf_token('activate' ~ annonce.id) }}">
                    <button type="submit"
                            class="glass-btn glass-btn-success px-4 py-2 inline-flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Activer
                    </button>
                </form>
            {% endif %}

            <a href="{{ path('admin_annonce_interne_edit', {id: annonce.id}) }}"
               class="glass-btn glass-btn-primary px-4 py-2 inline-flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
                Modifier
            </a>
        </div>
    </div>
</div>
{% endblock %}
