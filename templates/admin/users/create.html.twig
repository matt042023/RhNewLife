{% extends 'base.html.twig' %}

{% block title %}Créer un salarié complet - RH NewLife{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style>
        /* Custom step-hidden class that hides content but preserves file inputs */
        /* Using height:0;overflow:hidden instead of display:none to keep file inputs functional */
        .step-hidden {
            height: 0;
            overflow: hidden;
            opacity: 0;
            position: absolute;
            pointer-events: none;
        }
        .step-content:not(.step-hidden) {
            position: relative;
            height: auto;
            overflow: visible;
            opacity: 1;
            pointer-events: auto;
        }
    </style>
{% endblock %}

{% block body %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-green-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 p-8"
     data-controller="direct-user-creation">
    <div class="max-w-5xl mx-auto">

        {# Header #}
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Créer un salarié</h1>
            <p class="text-gray-600 dark:text-gray-400 mt-1">Création complète avec documents et contrat (pour employés existants)</p>
        </div>

        {# Flash errors #}
        {% if flashErrors is not empty %}
            <div class="glass-card glass-card-danger mb-6 p-4">
                <ul class="list-disc list-inside text-red-800 dark:text-red-200">
                    {% for error in flashErrors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {# Form errors by section #}
        {% if formErrors is not empty %}
            <div class="glass-card glass-card-danger mb-6 p-4">
                <p class="font-semibold text-red-800 dark:text-red-200 mb-2">Veuillez corriger les erreurs suivantes :</p>
                {% for section, errors in formErrors %}
                    <div class="mb-2">
                        <span class="font-medium text-red-700 dark:text-red-300">
                            {% if section == 'personal' %}Informations personnelles{% endif %}
                            {% if section == 'documents' %}Documents{% endif %}
                            {% if section == 'contract' %}Contrat{% endif %}
                            {% if section == 'activation' %}Activation{% endif %}
                        </span>
                        <ul class="list-disc list-inside text-red-800 dark:text-red-200 ml-4">
                            {% for field, error in errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {# Step indicator #}
        <div class="mb-8">
            <div class="flex items-center justify-between">
                {% set steps = [
                    {id: 1, name: 'Informations', icon: 'user'},
                    {id: 2, name: 'Documents', icon: 'document'},
                    {id: 3, name: 'Contrat', icon: 'briefcase'},
                    {id: 4, name: 'Activation', icon: 'key'},
                    {id: 5, name: 'Résumé', icon: 'check'}
                ] %}
                {% for step in steps %}
                    <div class="flex items-center {% if not loop.last %}flex-1{% endif %}">
                        <div class="step-indicator flex flex-col items-center"
                             data-direct-user-creation-target="stepIndicator"
                             data-step="{{ step.id }}">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300
                                        {% if step.id == 1 %}bg-blue-600 text-white{% else %}bg-white/50 dark:bg-gray-700 text-gray-500 dark:text-gray-400{% endif %}">
                                {% if step.icon == 'user' %}
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                    </svg>
                                {% elseif step.icon == 'document' %}
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                {% elseif step.icon == 'briefcase' %}
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                    </svg>
                                {% elseif step.icon == 'key' %}
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z" />
                                    </svg>
                                {% elseif step.icon == 'check' %}
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                    </svg>
                                {% endif %}
                            </div>
                            <span class="text-xs mt-2 font-medium text-gray-600 dark:text-gray-400">{{ step.name }}</span>
                        </div>
                        {% if not loop.last %}
                            <div class="flex-1 h-0.5 bg-gray-200 dark:bg-gray-700 mx-4 step-line"
                                 data-direct-user-creation-target="stepLine"
                                 data-step="{{ step.id }}"></div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>

        {# Form #}
        <form method="post" enctype="multipart/form-data" class="glass-card p-8"
              data-direct-user-creation-target="form">

            {# Step 1: Personal Information #}
            {# IMPORTANT: Using step-hidden class instead of hidden to preserve file inputs #}
            {# hidden/display:none can cause browsers to not submit file inputs #}
            <div class="step-content" data-direct-user-creation-target="stepContent" data-step="1">
                {% include 'admin/users/_create_personal.html.twig' %}
            </div>

            {# Step 2: Documents #}
            <div class="step-content step-hidden" data-direct-user-creation-target="stepContent" data-step="2">
                {% include 'admin/users/_create_documents.html.twig' %}
            </div>

            {# Step 3: Contract #}
            <div class="step-content step-hidden" data-direct-user-creation-target="stepContent" data-step="3">
                {% include 'admin/users/_create_contract.html.twig' %}
            </div>

            {# Step 4: Activation #}
            <div class="step-content step-hidden" data-direct-user-creation-target="stepContent" data-step="4">
                {% include 'admin/users/_create_activation.html.twig' %}
            </div>

            {# Step 5: Summary #}
            <div class="step-content step-hidden" data-direct-user-creation-target="stepContent" data-step="5">
                {% include 'admin/users/_create_summary.html.twig' %}
            </div>

            {# Navigation buttons #}
            <div class="flex items-center justify-between pt-6 mt-6 border-t border-white/10">
                <div>
                    <a href="{{ path('app_admin_users_list') }}" class="glass-btn px-4 py-2 mr-2">
                        Annuler
                    </a>
                    <button type="button" class="glass-btn px-4 py-2 hidden"
                            data-direct-user-creation-target="prevButton"
                            data-action="direct-user-creation#previousStep">
                        <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                        Précédent
                    </button>
                </div>
                <div>
                    <button type="button" class="glass-btn glass-btn-primary px-6 py-2"
                            data-direct-user-creation-target="nextButton"
                            data-action="direct-user-creation#nextStep">
                        Suivant
                        <svg class="w-4 h-4 ml-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                    <button type="submit" class="glass-btn glass-btn-primary px-6 py-2 hidden"
                            data-direct-user-creation-target="submitButton">
                        <svg class="w-5 h-5 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Créer le salarié
                    </button>
                </div>
            </div>
        </form>

        {# Info box #}
        <div class="mt-6 glass-card glass-card-primary p-4 animate-slide-in-glass">
            <div class="flex gap-3">
                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <div class="text-sm text-blue-800 dark:text-blue-200">
                    <p class="font-semibold mb-1">Création complète d'un salarié</p>
                    <p>Ce formulaire permet de créer un salarié avec tous ses documents et son contrat en une seule opération. Idéal pour l'import des employés existants lors de la mise en place de l'application.</p>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock %}
