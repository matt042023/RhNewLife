{% extends 'base.html.twig' %}

{% block title %}
	{{ user.fullName }}
	- RH NewLife
{% endblock %}

{% block body %}
	<div class="min-h-screen bg-gray-50 p-8">
		<div
			class="max-w-7xl mx-auto">

			{# Header avec actions #}
			<div class="flex items-start justify-between mb-8">
				<div class="flex items-center gap-4">
					<div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white text-2xl font-bold">
						{{ user.firstName|first }}{{ user.lastName|first }}
					</div>
					<div>
						<h1 class="text-3xl font-bold text-gray-900">{{ user.fullName }}</h1>
						<div class="flex items-center gap-3 mt-2">
							<span class="font-mono text-sm text-gray-600">{{ user.matricule ?? 'Pas de matricule' }}</span>
							<span class="text-gray-300">•</span>
							{% if user.status == 'active' %}
								<span class="badge badge-success">Actif</span>
							{% elseif user.status == 'onboarding' %}
								<span class="badge badge-warning">Onboarding</span>
							{% elseif user.status == 'invited' %}
								<span class="badge badge-info">Invité</span>
							{% elseif user.status == 'archived' %}
								<span class="badge badge-neutral">Archivé</span>
							{% endif %}
						</div>
					</div>
				</div>

				<div class="flex gap-3">
					<a href="{{ path('app_admin_users_edit', {id: user.id}) }}" class="btn btn-secondary">
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
						</svg>
						Modifier
					</a>

					{% if user.status != 'archived' %}
						<form method="post" action="{{ path('app_admin_users_archive', {id: user.id}) }}" onsubmit="return confirm('Archiver ce salarié ?')">
							<button type="submit" class="btn btn-outline-danger">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
								</svg>
								Archiver
							</button>
						</form>
					{% else %}
						<form method="post" action="{{ path('app_admin_users_reactivate', {id: user.id}) }}">
							<button type="submit" class="btn btn-success">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
								</svg>
								Réactiver
							</button>
						</form>
					{% endif %}
				</div>
			</div>

			{# Flash messages #}
			{% for label, messages in app.flashes %}
				{% for message in messages %}
					<div class="alert alert-{{ label == 'error' ? 'error' : (label == 'success' ? 'success' : 'info') }} mb-6">
						{{ message }}
					</div>
				{% endfor %}
			{% endfor %}

			{# Alerte si dossier incomplet #}
			{% if not completionStatus.isComplete %}
				<div class="alert alert-warning mb-6">
					<div class="flex items-start gap-3">
						<svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
						</svg>
						<div class="flex-1">
							<p class="font-semibold">Dossier incomplet ({{ completionStatus.percentage }}%)</p>
							{% if completionStatus.missingFields is not empty %}
								<p class="text-sm mt-1">Champs manquants :
									{{ completionStatus.missingFields|join(', ') }}</p>
							{% endif %}
							{% if completionStatus.missingDocuments is not empty %}
								<p class="text-sm mt-1">Documents manquants :
									{{ completionStatus.missingDocuments|join(', ') }}</p>
							{% endif %}
						</div>
					</div>
				</div>
			{% endif %}

			{# Onglets #}
			<div
				class="bg-white rounded-2xl shadow-lg overflow-hidden">
				{# Navigation tabs - Style Flowbite moderne #}
				<div class="border-b border-gray-200 dark:border-gray-700">
					<nav class="flex flex-wrap -mb-px" role="tablist">
						<button
							class="inline-flex items-center gap-2 px-6 py-4 text-sm font-medium border-b-2 border-blue-600 text-blue-600 bg-blue-50 dark:bg-blue-900/20 dark:text-blue-400 dark:border-blue-400 rounded-t-lg active group"
							data-tab="infos"
							type="button"
							role="tab"
							aria-selected="true">
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
							</svg>
							Informations
						</button>
						<button
							class="inline-flex items-center gap-2 px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 rounded-t-lg group"
							data-tab="contracts"
							type="button"
							role="tab"
							aria-selected="false">
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
							</svg>
							<span>Contrats</span>
							<span class="inline-flex items-center justify-center px-2 py-0.5 text-xs font-medium text-gray-800 bg-gray-100 rounded-full dark:bg-gray-700 dark:text-gray-300">
								{{ contracts|length }}
							</span>
						</button>
						<button
							class="inline-flex items-center gap-2 px-6 py-4 text-sm font-medium border-b-2 border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 rounded-t-lg group"
							data-tab="documents"
							type="button"
							role="tab"
							aria-selected="false">
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
							</svg>
							<span>Documents</span>
							<span class="inline-flex items-center justify-center px-2 py-0.5 text-xs font-medium text-gray-800 bg-gray-100 rounded-full dark:bg-gray-700 dark:text-gray-300">
								{{ documents|length }}
							</span>
						</button>
					</nav>
				</div>

				{# Tab content: Informations #}
				<div id="tab-infos" class="tab-content active p-8">
					<div class="grid grid-cols-2 gap-8">
						<div>
							<h3 class="text-lg font-bold text-gray-900 mb-4">Informations personnelles</h3>
							<dl class="space-y-3">
								<div>
									<dt class="text-sm text-gray-500">Email</dt>
									<dd class="text-gray-900">{{ user.email }}</dd>
								</div>
								<div>
									<dt class="text-sm text-gray-500">Téléphone</dt>
									<dd class="text-gray-900">{{ user.phone ?? '-' }}</dd>
								</div>
								<div>
									<dt class="text-sm text-gray-500">Adresse</dt>
									<dd class="text-gray-900">{{ user.address ?? '-' }}</dd>
								</div>
								<div>
									<dt class="text-sm text-gray-500">Situation familiale</dt>
									<dd class="text-gray-900">{{ user.familyStatus ?? '-' }}</dd>
								</div>
								<div>
									<dt class="text-sm text-gray-500">Enfants</dt>
									<dd class="text-gray-900">{{ user.children ?? 0 }}</dd>
								</div>
							</dl>
						</div>

						<div>
							<h3 class="text-lg font-bold text-gray-900 mb-4">Informations professionnelles</h3>
							<dl class="space-y-3">
								<div>
									<dt class="text-sm text-gray-500">Poste</dt>
									<dd class="text-gray-900">{{ user.position ?? '-' }}</dd>
								</div>
								<div>
									<dt class="text-sm text-gray-500">Structure</dt>
									<dd class="text-gray-900">{{ user.structure ?? '-' }}</dd>
								</div>
								<div>
									<dt class="text-sm text-gray-500">Date d'embauche</dt>
									<dd class="text-gray-900">{{ user.hiringDate ? user.hiringDate|date('d/m/Y') : '-' }}</dd>
								</div>
								<div>
									<dt class="text-sm text-gray-500">Matricule</dt>
									<dd class="font-mono text-gray-900">{{ user.matricule ?? '-' }}</dd>
								</div>
							</dl>
						</div>

						<div class="col-span-2">
							<h3 class="text-lg font-bold text-gray-900 mb-4">Informations bancaires</h3>
							<dl class="grid grid-cols-2 gap-6">
								<div>
									<dt class="text-sm text-gray-500">IBAN</dt>
									<dd class="font-mono text-gray-900">{{ user.iban ?? '-' }}</dd>
								</div>
								<div>
									<dt class="text-sm text-gray-500">BIC</dt>
									<dd class="font-mono text-gray-900">{{ user.bic ?? '-' }}</dd>
								</div>
							</dl>
						</div>
					</div>

					{# Progression bar #}
					<div class="mt-8 pt-8 border-t">
						<div class="flex items-center justify-between mb-2">
							<span class="text-sm font-semibold text-gray-700">Complétude du dossier</span>
							<span class="text-sm font-bold text-gray-900">{{ completionStatus.percentage }}%</span>
						</div>
						<div class="w-full bg-gray-200 rounded-full h-3">
							<div class="bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all" style="width: {{ completionStatus.percentage }}%"></div>
						</div>
					</div>
				</div>

				{# Tab content: Contrats #}
				<div id="tab-contracts" class="tab-content p-8 hidden">
					<div class="flex justify-between items-center mb-6">
						<h3 class="text-lg font-bold text-gray-900">Contrats</h3>
						<a href="{{ path('app_admin_contracts_create', {userId: user.id}) }}" class="btn btn-primary">
							<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
							</svg>
							Créer un contrat
						</a>
					</div>

					{% if contracts is empty %}
						<div class="text-center py-12">
							<svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
							</svg>
							<p class="text-gray-600">Aucun contrat pour ce salarié</p>
						</div>
					{% else %}
						<div class="space-y-4">
							{% for contract in contracts %}
								<div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition">
									<div class="flex items-center justify-between">
										<div class="flex-1">
											<div class="flex items-center gap-3 mb-2">
												<h4 class="font-bold text-gray-900">{{ contract.type }}</h4>
												{% if contract.status == 'draft' %}
													<span class="badge badge-neutral">Brouillon</span>
												{% elseif contract.status == 'active' %}
													<span class="badge badge-success">Actif</span>
												{% elseif contract.status == 'signed' %}
													<span class="badge badge-info">Signé</span>
												{% elseif contract.status == 'terminated' %}
													<span class="badge badge-neutral">Terminé</span>
												{% endif %}
												{% if contract.isAmendment %}
													<span class="badge badge-warning">Avenant v{{ contract.version }}</span>
												{% endif %}
											</div>
											<p class="text-sm text-gray-600">
												Du
												{{ contract.startDate|date('d/m/Y') }}
												{% if contract.endDate %}
													au
													{{ contract.endDate|date('d/m/Y') }}
												{% else %}
													(CDI)
												{% endif %}
											</p>
											<p class="text-sm text-gray-600 mt-1">
												Salaire :
												{{ contract.baseSalary }}
												€ brut
											</p>
										</div>
										<a href="{{ path('app_admin_contracts_view', {id: contract.id}) }}" class="btn btn-secondary">
											Voir
										</a>
									</div>
								</div>
							{% endfor %}
						</div>
					{% endif %}
				</div>

				{# Tab content: Documents #}
				<div id="tab-documents" class="tab-content p-8 hidden">
					<h3 class="text-lg font-bold text-gray-900 mb-6">Documents</h3>

					{% if documents is empty %}
						<div class="text-center py-12">
							<svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
							</svg>
							<p class="text-gray-600">Aucun document uploadé</p>
						</div>
					{% else %}
						<div class="grid grid-cols-2 gap-4">
							{% for document in documents %}
								<div class="border border-gray-200 rounded-lg p-4">
									<div class="flex items-start gap-3">
										<svg class="w-10 h-10 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewbox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
										</svg>
										<div class="flex-1 min-w-0">
											<h4 class="font-semibold text-gray-900 truncate">{{ document.originalName }}</h4>
											<p class="text-sm text-gray-500 mt-1">{{ document.type }}</p>
											<p class="text-xs text-gray-400 mt-1">{{ document.uploadedAt|date('d/m/Y H:i') }}</p>
										</div>
									</div>
								</div>
							{% endfor %}
						</div>
					{% endif %}
				</div>
			</div>

			{# Retour #}
			<div class="mt-6">
				<a href="{{ path('app_admin_users_list') }}" class="text-blue-600 hover:text-blue-800 font-semibold inline-flex items-center gap-2">
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
					</svg>
					Retour à la liste
				</a>
			</div>

		</div>
	</div>

	<script>
		// Tabs functionality
		document.addEventListener('DOMContentLoaded', function () {
			const tabButtons = document.querySelectorAll('[role="tab"]');
			const tabContents = document.querySelectorAll('.tab-content');

			tabButtons.forEach(button => {
				button.addEventListener('click', () => {
					const tabId = button.getAttribute('data-tab');

					// Remove active state from all buttons
					tabButtons.forEach(btn => {
						btn.classList.remove('border-blue-600', 'text-blue-600', 'bg-blue-50', 'active');
						btn.classList.remove('dark:bg-blue-900/20', 'dark:text-blue-400', 'dark:border-blue-400');
						btn.classList.add('border-transparent', 'text-gray-600', 'hover:text-gray-900', 'hover:border-gray-300');
						btn.classList.add('dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-600');
						btn.setAttribute('aria-selected', 'false');
					});

					// Hide all tab contents
					tabContents.forEach(content => content.classList.add('hidden'));

					// Add active state to clicked button
					button.classList.remove('border-transparent', 'text-gray-600', 'hover:text-gray-900', 'hover:border-gray-300');
					button.classList.remove('dark:text-gray-400', 'dark:hover:text-gray-300', 'dark:hover:border-gray-600');
					button.classList.add('border-blue-600', 'text-blue-600', 'bg-blue-50', 'active');
					button.classList.add('dark:bg-blue-900/20', 'dark:text-blue-400', 'dark:border-blue-400');
					button.setAttribute('aria-selected', 'true');

					// Show corresponding tab content
					document.getElementById('tab-' + tabId).classList.remove('hidden');
				});
			});
		});
	</script>
{% endblock %}
