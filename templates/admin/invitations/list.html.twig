{% extends 'base.html.twig' %}

{% block title %}Invitations - RH NewLife
{% endblock %}

{% block body %}
	<div class="min-h-screen bg-gray-50 p-8">
		<div
			class="max-w-7xl mx-auto">

			{# Header #}
			<div class="flex items-center justify-between mb-8">
				<div>
					<h1 class="text-3xl font-bold text-gray-900">Invitations</h1>
					<p class="text-gray-600 mt-1">Gérez les invitations d'onboarding</p>
				</div>
				<a href="{{ path('app_admin_invitations_create') }}" class="btn btn-primary">
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
					</svg>
					Nouvelle invitation
				</a>
			</div>

			{# Flash messages #}
			{% for label, messages in app.flashes %}
				{% for message in messages %}
					<div class="alert alert-{{ label == 'error' ? 'error' : (label == 'success' ? 'success' : 'info') }} mb-4">
						{{ message }}
					</div>
				{% endfor %}
			{% endfor %}

			{# Filtres #}
			<div class="bg-white rounded-2xl p-6 shadow-lg mb-6">
				<form method="get" class="flex gap-4">
					<div class="flex-1">
						<input type="text" name="search" value="{{ search ?? '' }}" placeholder="Rechercher par nom ou email..." class="form-input">
					</div>
					<div>
						<select name="status" class="form-select">
							<option value="">Tous les statuts</option>
							<option value="pending" {{ currentStatus == 'pending' ? 'selected' : '' }}>En attente</option>
							<option value="used" {{ currentStatus == 'used' ? 'selected' : '' }}>Utilisé</option>
							<option value="expired" {{ currentStatus == 'expired' ? 'selected' : '' }}>Expiré</option>
							<option value="error" {{ currentStatus == 'error' ? 'selected' : '' }}>Erreur</option>
						</select>
					</div>
					<button type="submit" class="btn btn-secondary">
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 1 1-14 0 7 7 0 0 1 14 0z"/>
						</svg>
						Filtrer
					</button>
				</form>
			</div>

			{# Liste des invitations #}
			{% if invitations is empty %}
				<div class="bg-white rounded-2xl p-12 shadow-lg text-center">
					<svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 0 0 2.22 0L21 8M5 19h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2z"/>
					</svg>
					<h3 class="text-xl font-semibold text-gray-900 mb-2">Aucune invitation</h3>
					<p class="text-gray-600 mb-6">Créez votre première invitation pour commencer</p>
					<a href="{{ path('app_admin_invitations_create') }}" class="btn btn-primary inline-flex">
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
						</svg>
						Créer une invitation
					</a>
				</div>
			{% else %}
				<div class="bg-white rounded-2xl shadow-lg overflow-hidden">
					<table class="w-full">
						<thead class="bg-gray-50 border-b border-gray-200">
							<tr>
								<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Salarié</th>
								<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Email</th>
								<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Poste</th>
								<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Statut</th>
								<th class="px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase">Suivis</th>
								<th class="px-6 py-4 text-right text-xs font-semibold text-gray-600 uppercase">Actions</th>
							</tr>
						</thead>
						<tbody class="divide-y divide-gray-200">
							{% for invitation in invitations %}
								<tr class="hover:bg-gray-50 transition">
									<td class="px-6 py-4">
										<div class="font-semibold text-gray-900">{{ invitation.fullName }}</div>
									</td>
									<td class="px-6 py-4 text-sm text-gray-600">{{ invitation.email }}</td>
									<td class="px-6 py-4 text-sm text-gray-600">{{ invitation.position ?? '-' }}</td>
									<td class="px-6 py-4">
										{% if invitation.status == 'pending' %}
											<span class="badge badge-warning">En attente</span>
										{% elseif invitation.status == 'used' %}
											<span class="badge badge-success">Utilisé</span>
										{% elseif invitation.status == 'expired' %}
											<span class="badge badge-neutral">Expiré</span>
										{% elseif invitation.status == 'error' %}
											<span class="badge badge-danger">Erreur</span>
										{% endif %}
									</td>
									<td class="px-6 py-4 text-sm text-gray-600">
										{% if invitation.status == 'used' %}
											soumis le
											{{ invitation.updatedAt|date('d/m/Y H:i') }}
										{% else %}
											expire le
											{{ invitation.expiresAt|date('d/m/Y H:i') }}
										{% endif %}
									</td>
									<td class="px-6 py-4 text-right">
										<div class="flex justify-end gap-2">
											{% if invitation.status in ['pending', 'expired', 'error'] %}
												<form method="post" action="{{ path('app_admin_invitations_resend', {id: invitation.id}) }}" class="inline">
													<button type="submit" class="text-blue-600 hover:text-blue-800 text-sm font-semibold">
														Relancer
													</button>
												</form>
											{% endif %}

											{% if invitation.status != 'used' %}
												<form method="post" action="{{ path('app_admin_invitations_delete', {id: invitation.id}) }}" class="inline" onsubmit="return confirm('Supprimer cette invitation ?')">
													<button type="submit" class="text-red-600 hover:text-red-800 text-sm font-semibold">
														Supprimer
													</button>
												</form>
											{% endif %}

											{% if invitation.status == 'used' %}
												<a href="{{ path('app_admin_validation_review', {id: invitation.user.id}) }}" class="btn btn-primary btn-sm">
													Examiner
												</a>
											{% endif %}
										</div>
									</td>
								</tr>
							{% endfor %}
						</tbody>
					</table>
				</div>
			{% endif %}

			{# Retour dashboard #}
			<div class="mt-6">
				<a href="{{ path('app_dashboard') }}" class="text-blue-600 hover:text-blue-800 font-semibold inline-flex items-center gap-2">
					<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
					</svg>
					Retour au dashboard
				</a>
			</div>

		</div>
	</div>
{% endblock %}
