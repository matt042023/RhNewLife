{% extends 'layout/dashboard_base.html.twig' %}

{% block title %}{{ villa.nom }} - RH NewLife{% endblock %}

{% block breadcrumb_items %}
	<li>
		<div class="flex items-center">
			<svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
			</svg>
			<a href="{{ path('app_dashboard') }}" class="ml-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ml-2 dark:text-gray-400 dark:hover:text-white">Administration</a>
		</div>
	</li>
	<li>
		<div class="flex items-center">
			<svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
			</svg>
			<a href="{{ path('app_admin_villas_list') }}" class="ml-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ml-2 dark:text-gray-400 dark:hover:text-white">Villas</a>
		</div>
	</li>
	<li aria-current="page">
		<div class="flex items-center">
			<svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
				<path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"></path>
			</svg>
			<span class="ml-1 text-sm font-medium text-gray-500 md:ml-2 dark:text-gray-400">{{ villa.nom }}</span>
		</div>
	</li>
{% endblock %}

{% block page_header %}
	<div class="px-4 py-6 lg:px-6">
		<div class="flex flex-col md:flex-row md:items-center md:justify-between">
			<div class="flex-1 min-w-0">
				<div class="flex items-center gap-3 mb-2">
					{% if villa.color %}
						<div class="w-8 h-8 rounded-full" style="background-color: {{ villa.color }}"></div>
					{% endif %}
					<h1 class="text-2xl md:text-3xl font-bold text-white">
						{{ villa.nom }}
					</h1>
				</div>
				<p class="text-blue-100 text-sm md:text-base">
					Détails de la villa et utilisateurs assignés
				</p>
			</div>
			<div class="mt-4 md:mt-0 md:ml-4 flex gap-2">
				<a href="{{ path('app_admin_villas_edit', {id: villa.id}) }}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 bg-white hover:bg-gray-50 rounded-lg transition focus:ring-4 focus:ring-blue-300">
					<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
					</svg>
					Modifier
				</a>
			</div>
		</div>
	</div>
{% endblock %}

{% block dashboard_content %}
	{# Informations de la villa #}
	<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6">
		<h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Informations</h2>
		<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
			<div>
				<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Nom</label>
				<p class="text-gray-900 dark:text-white font-medium">{{ villa.nom }}</p>
			</div>
			<div>
				<label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Couleur</label>
				{% if villa.color %}
					<div class="flex items-center gap-2">
						<div class="w-6 h-6 rounded border border-gray-300" style="background-color: {{ villa.color }}"></div>
						<span class="text-gray-900 dark:text-white font-mono">{{ villa.color }}</span>
					</div>
				{% else %}
					<p class="text-gray-500 dark:text-gray-400">-</p>
				{% endif %}
			</div>
		</div>

		<div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700 grid grid-cols-1 md:grid-cols-3 gap-4">
			<div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
				<div class="text-sm font-medium text-blue-600 dark:text-blue-400">Utilisateurs actifs</div>
				<div class="text-2xl font-bold text-blue-900 dark:text-blue-100 mt-1">{{ villa.activeUsersCount }}</div>
			</div>
			<div class="bg-green-50 dark:bg-green-900/20 p-4 rounded-lg">
				<div class="text-sm font-medium text-green-600 dark:text-green-400">Total utilisateurs</div>
				<div class="text-2xl font-bold text-green-900 dark:text-green-100 mt-1">{{ villa.users|length }}</div>
			</div>
			<div class="bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg">
				<div class="text-sm font-medium text-purple-600 dark:text-purple-400">Affectations</div>
				<div class="text-2xl font-bold text-purple-900 dark:text-purple-100 mt-1">{{ villa.affectations|length }}</div>
			</div>
		</div>
	</div>

	{# Liste des utilisateurs assignés #}
	<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-6">
		<h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Utilisateurs assignés ({{ activeUsers|length }})</h2>

		{% if activeUsers is empty %}
			<div class="text-center py-8 text-gray-500 dark:text-gray-400">
				<svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
				</svg>
				<p class="mt-2">Aucun utilisateur actif assigné à cette villa</p>
			</div>
		{% else %}
			<div class="overflow-x-auto">
				<table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
					<thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
						<tr>
							<th scope="col" class="px-6 py-3">Nom</th>
							<th scope="col" class="px-6 py-3">Email</th>
							<th scope="col" class="px-6 py-3">Poste</th>
							<th scope="col" class="px-6 py-3">Actions</th>
						</tr>
					</thead>
					<tbody>
						{% for user in activeUsers %}
							<tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
								<td class="px-6 py-4 font-medium text-gray-900 dark:text-white">
									{{ user.fullName }}
								</td>
								<td class="px-6 py-4">
									{{ user.email }}
								</td>
								<td class="px-6 py-4">
									{{ user.position ?? '-' }}
								</td>
								<td class="px-6 py-4">
									<a href="{{ path('app_admin_users_view', {id: user.id}) }}" class="text-blue-600 hover:text-blue-800 dark:text-blue-500 dark:hover:text-blue-400">
										Voir le profil
									</a>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		{% endif %}
	</div>

	{# Actions #}
	<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6">
		<h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Actions</h2>

		{% if canDelete %}
			<form method="post" action="{{ path('app_admin_villas_delete', {id: villa.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette villa ?');">
				<button type="submit" class="inline-flex items-center px-4 py-2 border border-red-300 text-sm font-medium rounded-md text-red-700 bg-white hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
					<svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
					</svg>
					Supprimer cette villa
				</button>
			</form>
			<p class="mt-2 text-sm text-gray-500 dark:text-gray-400">Cette villa peut être supprimée car aucun utilisateur ni affectation n'y est lié.</p>
		{% else %}
			<div class="p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-md">
				<div class="flex">
					<svg class="h-5 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
						<path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
					</svg>
					<div class="ml-3">
						<h3 class="text-sm font-medium text-yellow-800 dark:text-yellow-200">Suppression impossible</h3>
						<p class="mt-1 text-sm text-yellow-700 dark:text-yellow-300">
							Cette villa ne peut pas être supprimée car {{ villa.users|length }} utilisateur{{ villa.users|length > 1 ? 's sont' : ' est' }} assigné{{ villa.users|length > 1 ? 's' : '' }} ou {{ villa.affectations|length }} affectation{{ villa.affectations|length > 1 ? 's existent' : ' existe' }}.
						</p>
					</div>
				</div>
			</div>
		{% endif %}
	</div>
{% endblock %}
